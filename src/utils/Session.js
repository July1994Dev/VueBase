const getCookie = (name) => {
  return document.cookie.split("; ").reduce((r, v) => {
    const parts = v.split("=");
    return parts[0] === name ? decodeURIComponent(parts[1]) : r;
  }, "");
};

const setCookie = (name, value, days, date = null) => {
  let d = new Date();
  if (date) {
    d = new Date(date);
  } else {
    d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
  }
  let expires = "expires=" + d.toUTCString();
  document.cookie = name + "=" + value + ";" + expires + ";path=/";
};

const validateSession = () => {
  const tkn = getCookie("ST");
  const data = parseJwt(tkn);
  return data ? true : false;
};

const parseJwt = (token) => {
  try {
    let base64Url = token.split(".")[1];
    let base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
    let jsonPayload = decodeURIComponent(
      atob(base64)
        .split("")
        .map(function (c) {
          return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
        })
        .join("")
    );

    return JSON.parse(jsonPayload);
  } catch {
    return "";
  }
};

export { getCookie, setCookie, validateSession, parseJwt };
